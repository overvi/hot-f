(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1108],{9862:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/crs/reservations/add",function(){return i(56433)}])},56433:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Y}});var n=i(85893),l=i(67294),r=i(80494),a=i(26036),s=i(18370),d=i(12930),o=i(33479),u=i(67421),v=i(37996),c=i(88243),p=i(44192),x=i(47807),h=i(197),f=i(62992),m=i(17312),g=i(82729),j=i(68806),Z=i(54910);function b(){let e=(0,g._)(["\n  mutation createReservation($input: CreateReservationInput!) {\n    createReservation(input: $input) {\n      id\n      details {\n        id\n        adults\n        children\n        infants\n        nights\n        status\n        checkedIn\n        checkedOut\n        fee\n        room {\n          id\n        }\n      }\n    }\n  }\n"]);return b=function(){return e},e}let I=(0,j.ZP)(b());(0,Z.B)(I);var S=i(50319),y=i(78605),N=i(45007),k=i(77502),D=i(94113);function w(){let e=(0,g._)(["\n  mutation assignExtraServices($input: AssignExtraServicesInput!) {\n    assignExtraServices(input: $input) {\n      id\n    }\n  }\n"]);return w=function(){return e},e}let C=(0,j.ZP)(w());(0,Z.B)(C);var P=i(98130),$=i(57632);function _(){let e=(0,g._)(["\n  mutation createUserBulk($input: [CreateUserInput]!) {\n    createUserBulk(input: $input) {\n      id\n      firstName\n      lastName\n    }\n  }\n"]);return _=function(){return e},e}let E=(0,j.ZP)(_());(0,Z.B)(E);var Y=(0,l.memo)(()=>{let e=!0,{t}=(0,u.$G)(),[i,g]=(0,l.useState)(0),[j,Z]=(0,l.useState)(),[b,w]=(0,l.useState)(null),[_,Y]=(0,l.useState)(null),[A,R]=(0,l.useState)((0,$.Z)()),[F,O]=(0,l.useState)([]),[B,M]=(0,l.useState)(),G=(0,y.Zl)(),U=(0,N.I0)(),{reservations:z,reservationUsers:T}=(0,N.v9)(e=>e.cart),{activeReservations:L,currentReservation:Q}=(0,N.v9)(e=>e.reservation),X=()=>{e&&(U.reservation.applyCurrentReservation([]),R(null))};(0,l.useEffect)(()=>{var e;let t=L.find(e=>e.uid===A);t&&M(null!=t?t:[]),t&&O(null!==(e=null==t?void 0:t.rooms)&&void 0!==e?e:[])},[A,L]),(0,l.useEffect)(()=>{Q&&setTimeout(()=>{var e,t;M(null!=Q?Q:[]),O(null==Q?void 0:null===(e=Q.reservation)||void 0===e?void 0:e.details),U.reservation.addActiveReservationProperty({rooms:null==Q?void 0:null===(t=Q.reservation)||void 0===t?void 0:t.details},null==Q?void 0:Q.uid),R(null==Q?void 0:Q.uid)},300)},[Q,U.reservation]),(0,l.useEffect)(()=>()=>{e=!1,X()},[]);let[q]=(0,S.D)(I,{onCompleted:e=>{let{createReservation:t}=e;if(t.id){var i;null==t||null===(i=t.details)||void 0===i||i.map((e,t)=>{var i,n,l;return{id:e.id,title:null===(i=z[t])||void 0===i?void 0:i.title,room:null==e?void 0:null===(n=e.room)||void 0===n?void 0:n.id,checkedOut:null==e?void 0:e.checkedOut,checkedIn:null==e?void 0:e.checkedIn,fee:null===(l=z[t])||void 0===l?void 0:l.fee,adult:null==e?void 0:e.adults,child:null==e?void 0:e.children,total:null==e?void 0:e.nights,rate:null==e?void 0:e.rate,source:b}}),Z(t),U.reservation.addActiveReservationProperty({reservation:t},A)}}}),[H,{loading:J}]=(0,S.D)(D.L,{onCompleted:e=>{let{updateReservation:t}=e;U.reservation.addActiveReservationProperty({reservation:t},A)}}),[K]=(0,S.D)(C),[V]=(0,S.D)(E,{onCompleted:e=>{var t;let{createUserBulk:i}=e,n=i.map(e=>e.id);H({variables:{input:{id:parseInt(null==B?void 0:B.reservation.id),hotel:null==G?void 0:null===(t=G.hotel)||void 0===t?void 0:t.id,description:"",guests:n}}})}}),[W,{loading:ee}]=(0,S.D)(k.c,{onCompleted:e=>{let{createUser:t}=e;if(t){var i,n;let e=null===(i=T.guests)||void 0===i?void 0:i.map(e=>({...e,email:e.mobileNumber,type:"user",category:"guest"}));(null==e?void 0:e.length)>0&&V({variables:{input:e}}),Y(t),H({variables:{input:{id:parseInt(null==B?void 0:B.reservation.id),booker:parseInt(t.id),hotel:null==G?void 0:null===(n=G.hotel)||void 0===n?void 0:n.id,title:(null==t?void 0:t.firstName)+" "+(null==t?void 0:t.lastName),description:""}}})}}}),et=()=>{if((null==F?void 0:F.length)===0)return!0};return(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(null==F?void 0:F.length)>0&&(0,n.jsx)(r.Z,{message:"هشدار",description:t("Your reservation process will be expire in 10 minutes!"),type:"warning",showIcon:!0,closable:!1,action:(0,n.jsx)(P.ZP,{date:Date.now()+9e5,renderer:e=>{let{hours:t,minutes:i,seconds:l,completed:r}=e;return r?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)("span",{className:"text-2xl mx-4 text-orange-500",children:[i,":",l]})}})}),(0,n.jsxs)("div",{className:"flex flex-row gap-x-2",children:[0===i&&(0,n.jsx)("div",{className:"basis-3/12",children:(0,n.jsx)(f.default,{activeId:A,activeReservation:B})}),(0,n.jsx)("div",{className:"".concat(0!==i?"basis-12/12":"basis-9/12"," w-full "),children:(0,n.jsxs)(a.Z,{loading:J,children:[(0,n.jsxs)(s.Z,{current:i,children:[(0,n.jsx)(s.Z.Step,{title:t("Availability")}),(0,n.jsx)(s.Z.Step,{title:t("Guest information")}),(0,n.jsx)(s.Z.Step,{title:t("Addon services")}),(0,n.jsx)(s.Z.Step,{title:t("Payment")})]}),(0,n.jsxs)("div",{className:"steps-content",children:[0===i&&(0,n.jsx)(v.default,{source:b,setSource:w,activeId:A,rooms:F,activeReservation:B}),1===i&&(0,n.jsx)(x.default,{activeId:A}),2===i&&(0,n.jsx)(m.default,{activeId:A}),3===i&&(0,n.jsx)(h.default,{activeId:A,updateLoading:J})]})]})})]}),(0,n.jsx)(a.Z,{size:"small",children:(0,n.jsxs)("div",{className:"justify-between flex flex-row",children:[(0,n.jsxs)(d.ZP,{disabled:0===i,size:"large",className:"basis-1/12 disabled:text-gray-300 disabled:border-0 justify-center bg-transparent text-orange-400 border border-orange-400 hover:bg-primary hover:text-primary-foreground  flex flex-row space-x-2 rtl:space-x-reverse items-center mt-2",onClick:()=>g(i-1),children:[(0,n.jsx)(c.Z,{}),t("Go back")]}),3!==i&&(0,n.jsx)(d.ZP,{loading:ee,onClick:()=>{var e,t,n,l,r,a,s,d,o,u,v,c,p,x;if(0===i){let i=null==B?void 0:null===(e=B.rooms)||void 0===e?void 0:e.map(e=>{var t,i,n,l,r,a;let s=null!==(l=e.adult)&&void 0!==l?l:e.adults,d=null!==(r=e.child)&&void 0!==r?r:e.children,o=null!==(a=e.total)&&void 0!==a?a:e.nights;return delete e.__typename,delete e.title,delete e.type,delete e.price,delete e.adult,delete e.child,delete e.source,delete e.total,{...e,...e.id&&{id:parseInt(e.id)},room:(null===(t=e.room)||void 0===t?void 0:t.id)?parseInt(null===(i=e.room)||void 0===i?void 0:i.id):parseInt(e.room),adults:s,children:d,nights:o,...(null==B?void 0:null===(n=B.reservation)||void 0===n?void 0:n.id)&&{reservation:parseInt(null==B?void 0:B.reservation.id)}}});(null==B?void 0:null===(t=B.reservation)||void 0===t?void 0:t.id)?H({variables:{input:{id:parseInt(null==B?void 0:B.reservation.id),hotel:null==G?void 0:null===(n=G.hotel)||void 0===n?void 0:n.id,fee:null==B?void 0:null===(l=B.rooms)||void 0===l?void 0:l.reduce((e,t)=>parseFloat(e)+parseFloat(t.fee),0),arrivalDate:null==B?void 0:null===(r=B.firstStep)||void 0===r?void 0:r.arrivalDate,departureDate:null==B?void 0:null===(a=B.firstStep)||void 0===a?void 0:a.departureDate,source:parseInt(null==B?void 0:null===(s=B.firstStep)||void 0===s?void 0:s.source),details:i}}}):q({variables:{input:{hotel:null==G?void 0:null===(d=G.hotel)||void 0===d?void 0:d.id,fee:null==B?void 0:null===(o=B.rooms)||void 0===o?void 0:o.reduce((e,t)=>parseFloat(e)+parseFloat(t.fee),0),arrivalDate:null==B?void 0:null===(u=B.firstStep)||void 0===u?void 0:u.arrivalDate,departureDate:null==B?void 0:null===(v=B.firstStep)||void 0===v?void 0:v.departureDate,source:parseInt(null==B?void 0:null===(c=B.firstStep)||void 0===c?void 0:c.source),details:i}}})}if(1===i){let e={...T};U.reservation.addActiveReservationProperty({user:T},A),delete e.guests,W({variables:{input:{...e,type:"user",category:"guest"}}})}2===i&&(null==B||null===(x=B.reservation)||void 0===x||null===(p=x.details)||void 0===p||p.map(e=>{var t,i,n,l,r;let a=null==e?void 0:null===(t=e.extraServices)||void 0===t?void 0:t.map(e=>parseFloat(e));(null==a?void 0:a.length)>0&&K({variables:{input:{id:parseFloat(e.id),extraServices:a}}}),H({variables:{input:{id:parseInt(null==B?void 0:B.reservation.id),folio:(null==B?void 0:null===(n=B.reservation)||void 0===n?void 0:null===(i=n.folios)||void 0===i?void 0:i.length)?null==B?void 0:null===(l=B.reservation)||void 0===l?void 0:l.folios[0].id:0,booker:parseInt(null==_?void 0:_.id),hotel:null==G?void 0:null===(r=G.hotel)||void 0===r?void 0:r.id}}})})),g(i+1)},size:"large",type:"default",disabled:et(),className:"justify-center   ".concat(et()?"":"hover:bg-primary hover:text-primary-foreground border-0 text-white bg-secondary"," flex flex-row space-x-2 rtl:space-x-reverse items-center mt-2"),children:(0,n.jsxs)(o.Z,{align:"center",gap:8,children:[t("Next"),(0,n.jsx)(p.Z,{})]})})]})})]})})},17312:function(e,t,i){"use strict";i.r(t);var n=i(85893),l=i(67294),r=i(40275),a=i(26036),s=i(33479),d=i(12213),o=i(12930),u=i(67421),v=i(45007),c=i(78605),p=i(22277),x=i(73711),h=i(73359),f=i(11337);t.default=(0,l.memo)(e=>{var t;let{activeId:i}=e,{t:m,i18n:g}=(0,u.$G)(),[j,Z]=(0,l.useState)(!1),[b,I]=(0,l.useState)(),[S,y]=(0,l.useState)([]),{activeReservations:N}=(0,v.v9)(e=>e.reservation);(0,v.I0)(),(0,l.useEffect)(()=>{y(N.find(e=>e.uid===i))},[S,i,N]);let[k,{data:D}]=(0,h.t)(f.c,{fetchPolicy:"cache-and-network"});return(0,l.useEffect)(()=>{k()},[]),(0,n.jsxs)("div",{className:"py-4",children:[(0,n.jsx)(x.default,{setShow:Z,show:j,index:b,activeId:i,extraServices:D}),(0,n.jsx)(r.Z,{grid:{gutter:16,xs:1,sm:2,md:4,lg:4,xl:4,xxl:4},dataSource:null==S?void 0:null===(t=S.reservation)||void 0===t?void 0:t.details,pagination:{hideOnSinglePage:!0},renderItem:(e,t)=>{var i;return(0,n.jsx)(r.Z.Item,{children:(0,n.jsx)(a.Z,{title:e.title,children:(0,n.jsxs)(s.Z,{vertical:!0,gap:20,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:(0,c.Qm)(e.title)}),(0,n.jsxs)("p",{children:[m("Adult"),":",e.adult]}),(0,n.jsxs)("p",{children:[m("Child"),":",e.child]}),(0,n.jsxs)(d.Z,{children:[m("قیمت برای")," ",e.nights," ",m("شب")," ",(0,c.aw)(e.fee),"تومان"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-green-700",children:(0,c.b2)(e.checkedIn,g.language,"YYYY-MM-DD")}),(0,n.jsx)("p",{className:"text-red-700",children:(0,c.b2)(e.checkedOut,g.language,"YYYY-MM-DD")})]}),(0,n.jsx)(s.Z,{children:null==e?void 0:null===(i=e.extraServices)||void 0===i?void 0:i.map(e=>{var t;return(0,n.jsx)(d.Z,{onClick:()=>Z(!0),children:null==D?void 0:null===(t=D.extraServices)||void 0===t?void 0:t.data.find(t=>t.id===e).title},e)})}),(0,n.jsx)(s.Z,{align:"center",gap:8,children:(0,n.jsx)(o.ZP,{onClick:()=>{Z(!0),I(t)},children:(0,n.jsxs)(s.Z,{align:"center",gap:8,children:[(0,n.jsx)(p.Z,{}),m("Add extra service")]})})})]})})})}})]})})},73711:function(e,t,i){"use strict";i.r(t);var n=i(85893),l=i(8453),r=i(34800),a=i(67415),s=i(89770),d=i(68616),o=i(67421),u=i(45007),v=i(78605);t.default=e=>{var t,i;let{index:c,show:p,setShow:x,activeId:h,extraServices:f}=e,m=(0,u.I0)(),[g]=l.Z.useForm(),{t:j}=(0,o.$G)();return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.Z,{title:j("Extra services"),open:p,onOk:()=>{g.validateFields().then(e=>{m.reservation.addExtraServices({index:c,values:e.services},h),x(!1)})},onCancel:()=>{x(!1)},destroyOnClose:!0,children:(0,n.jsx)(l.Z,{form:g,layout:"vertical",children:(0,n.jsx)(l.Z.Item,{name:"services",label:j("Select service"),children:(0,n.jsx)(a.Z.Group,{style:{width:"100%"},onChange:e=>{console.log("checked = ",e)},children:(0,n.jsx)(s.Z,{children:null==f?void 0:null===(i=f.extraServices)||void 0===i?void 0:null===(t=i.data)||void 0===t?void 0:t.map(e=>(0,n.jsx)(d.Z,{span:8,children:(0,n.jsxs)(a.Z,{value:e.id,children:[e.title," ",(0,n.jsx)("span",{children:(0,v.aw)(null==e?void 0:e.amount)})]})},e.id))})})})})})})}},62992:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Z}});var n=i(85893),l=i(50319),r=i(82729),a=i(68806),s=i(54910);function d(){let e=(0,r._)(["\n  mutation deleteReservationDetail($id: ID!) {\n    deleteReservationDetail(id: $id) {\n      id\n    }\n  }\n"]);return d=function(){return e},e}let o=(0,a.ZP)(d());(0,s.B)(o);var u=i(56978),v=i(78605),c=i(26036),p=i(33479),x=i(12213),h=i(35394),f=i(11631),m=i(67294),g=i(67421),j=i(45007),Z=(0,m.memo)(e=>{let{activeId:t}=e,{t:i,i18n:r}=(0,g.$G)(),[a,s]=(0,m.useState)([]),{activeReservations:d}=(0,j.v9)(e=>e.reservation),[Z]=(0,l.D)(u.h),[b]=(0,l.D)(o),I=(0,j.I0)(),S=e=>{let i=d.find(e=>e.uid===t),n=null==i?void 0:i.rooms[e];if((null==n?void 0:n.id)&&b({variables:{id:null==n?void 0:n.id}}),Z({variables:{input:{id:parseInt(null==n?void 0:n.room),status:"Unoccupied"}}}),n){var l;null===(l=I.reservation)||void 0===l||l.removeRoomFromActiveRoom(null==n?void 0:n.room,t)}};return(0,m.useEffect)(()=>{let e=d.find(e=>e.uid===t);e&&s(e.rooms)},[t,d]),(0,n.jsx)(c.Z,{title:i("Reservation details"),className:"h-full",children:(null==a?void 0:a.length)>0?null==a?void 0:a.map((e,t)=>(0,n.jsxs)(p.Z,{justify:"space-between",className:"pb-6 items-center",children:[(0,n.jsxs)(p.Z,{vertical:!0,children:[(0,n.jsx)("p",{children:(0,v.Qm)(e.title)}),(0,n.jsxs)("p",{children:[i("Adult"),":",e.adult]}),(0,n.jsxs)("p",{children:[i("Child"),":",e.child]}),(0,n.jsxs)(x.Z,{children:[i("قیمت برای")," ",e.total," ",i("شب")," ",(0,v.aw)(parseFloat(e.fee))," تومان"]})]}),(0,n.jsxs)(p.Z,{vertical:!0,children:[(0,n.jsx)("p",{className:"text-green-700",children:(0,v.b2)(e.checkedIn,r.language,"YYYY-MM-DD")}),(0,n.jsx)("p",{className:"text-red-700",children:(0,v.b2)(e.checkedOut,r.language,"YYYY-MM-DD")})]}),(0,n.jsx)(f.Z,{color:"red",size:22,onClick:()=>S(t),className:"cursor-pointer",variant:"Bulk"})]},e.room)):(0,n.jsx)(h.Z,{})})})},77502:function(e,t,i){"use strict";i.d(t,{c:function(){return s}});var n=i(82729),l=i(68806),r=i(54910);function a(){let e=(0,n._)(["\n  mutation createUser($input: CreateUserInput!) {\n    createUser(input: $input) {\n      id\n      firstName\n      lastName\n    }\n  }\n"]);return a=function(){return e},e}let s=(0,l.ZP)(a());(0,r.B)(s)},11337:function(e,t,i){"use strict";i.d(t,{c:function(){return s}});var n=i(82729),l=i(68806),r=i(54910);function a(){let e=(0,n._)(["\n  query extraServices($first: Int, $page: Int, $args: ExtraServiceArgs) {\n    extraServices(first: $first, page: $page, args: $args) {\n      paginatorInfo {\n        total\n      }\n      data {\n        id\n        title\n        type\n        slug\n        description\n        icon\n        amount\n        isPercentage\n        isActive\n        deletedAt\n        createdAt\n        updatedAt\n      }\n    }\n  }\n"]);return a=function(){return e},e}let s=(0,l.ZP)(a());(0,r.B)(s)}},function(e){e.O(0,[5675,6036,7415,9477,2427,9157,3635,7507,2594,8718,842,2421,7807,7996,197,9774,2888,179],function(){return e(e.s=9862)}),_N_E=e.O()}]);