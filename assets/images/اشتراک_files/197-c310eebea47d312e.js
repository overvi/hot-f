"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[197],{197:function(e,n,i){i.r(n);var l=i(85893),t=i(67421),o=i(67294),r=i(25973),d=i(33479),a=i(82809),s=i(89770),u=i(68616),v=i(63635),c=i(26036),m=i(19477),x=i(14838),h=i(45007),p=i(78605),b=i(3067),g=i.n(b);n.default=e=>{var n,i,b,f,j,y,k,N,Z,I,Y,w,S,P,R,M,A,C,D,T,_,O,$,G,E,z,B,L,q,F,H;let{activeId:U,updateLoading:J}=e,{t:K,i18n:Q}=(0,t.$G)(),[V,W]=(0,o.useState)([]),[X,ee]=(0,o.useState)(),{activeReservations:en}=(0,h.v9)(e=>e.reservation),ei=(null==X?void 0:X.reservation)?g()(null==X?void 0:null===(i=X.reservation)||void 0===i?void 0:null===(n=i.details[0])||void 0===n?void 0:n.checkedIn).format("YYYY/MM/D"):null,el=(null==X?void 0:X.reservation)?g()(null==X?void 0:null===(f=X.reservation)||void 0===f?void 0:null===(b=f.details[0])||void 0===b?void 0:b.checkedOut).format("YYYY/MM/D"):null,et=[{title:K("Room type"),key:"title",render:e=>(0,l.jsx)("p",{children:e.title})},{title:K("Guest name"),key:"name",render:e=>(0,l.jsx)("p",{children:null==e?void 0:e.name})},{title:K("Arrival/ Departure"),key:"arrival",render:e=>(0,l.jsxs)("p",{children:[ei," - ",el]})},{title:K("Guests composition"),key:"tags",render:(e,n)=>(0,l.jsx)(l.Fragment,{children:null==n?void 0:n.guests})},{title:K("Accomodation"),key:"action",render:(e,n)=>(0,l.jsx)(r.Z,{size:"middle",children:n.nights})},{title:K("Total price"),key:"action",render:(e,n)=>(0,l.jsxs)(d.Z,{gap:4,children:[(0,p.aw)(null==n?void 0:n.fee),(0,l.jsx)("span",{children:"تومان"})]})}],eo=[{key:"1",label:K("Arrival date"),children:(0,p.b2)(null==X?void 0:null===(y=X.reservation)||void 0===y?void 0:null===(j=y.details[0])||void 0===j?void 0:j.checkedIn,Q.language,"YYYY/MM/D")},{key:"3",label:K("Reservation source"),children:K(null==X?void 0:null===(N=X.reservation)||void 0===N?void 0:null===(k=N.source)||void 0===k?void 0:k.title)},{key:"2",label:K("Accomodation"),children:null==X?void 0:null===(Z=X.reservation)||void 0===Z?void 0:Z.reservationNumber},{key:"4",label:K("Departure date"),children:(0,p.b2)(null==X?void 0:null===(Y=X.reservation)||void 0===Y?void 0:null===(I=Y.details[0])||void 0===I?void 0:I.checkedOut,Q.language,"YYYY/MM/D")},{key:"5",label:K("Reservation date"),children:(null==X?void 0:null===(w=X.reservation)||void 0===w?void 0:w.createdAt)?g()(null==X?void 0:null===(S=X.reservation)||void 0===S?void 0:S.createdAt).format("YYYY/MM/D H:mm A"):"-",span:2},{key:"6",label:K("Status"),children:(0,l.jsx)(a.Z,{status:"processing",text:K((0,p.l4)(null==X?void 0:null===(P=X.reservation)||void 0===P?void 0:P.status))}),span:3},{key:"10",label:K("Guest details"),children:(0,l.jsxs)(d.Z,{gap:18,children:[(0,l.jsxs)("div",{className:"bg-orange-50 rounded-lg p-3",children:[K("Name"),":"," ",null==X?void 0:null===(M=X.reservation)||void 0===M?void 0:null===(R=M.booker)||void 0===R?void 0:R.firstName,null==X?void 0:null===(C=X.reservation)||void 0===C?void 0:null===(A=C.booker)||void 0===A?void 0:A.lastName,(0,l.jsx)("br",{}),K("Email"),":"," ",null==X?void 0:null===(T=X.reservation)||void 0===T?void 0:null===(D=T.booker)||void 0===D?void 0:D.email,(0,l.jsx)("br",{}),K("Mobile number"),":",null==X?void 0:null===(O=X.reservation)||void 0===O?void 0:null===(_=O.booker)||void 0===_?void 0:_.mobileNumber,(0,l.jsx)("br",{}),K("National Number"),":",null==X?void 0:null===(G=X.reservation)||void 0===G?void 0:null===($=G.booker)||void 0===$?void 0:$.nationalId,(0,l.jsx)("br",{}),K("Gender"),":"," ",K(null==X?void 0:null===(z=X.reservation)||void 0===z?void 0:null===(E=z.booker)||void 0===E?void 0:E.gender)]}),null==X?void 0:null===(L=X.reservation)||void 0===L?void 0:null===(B=L.guests)||void 0===B?void 0:B.map(e=>(0,l.jsxs)("div",{className:"rounded-lg p-3 bg-green-50",children:[K("Name"),":"," ",null==e?void 0:e.firstName," ",null==e?void 0:e.lastName,(0,l.jsx)("br",{}),K("Email"),":"," ",null==e?void 0:e.email,(0,l.jsx)("br",{}),K("Mobile number"),":",null==e?void 0:e.mobileNumber,(0,l.jsx)("br",{}),K("National Number"),":",null==e?void 0:e.nationalId,(0,l.jsx)("br",{}),K("Gender"),":"," ",K(null==e?void 0:e.gender)]},e.id))]})}];return(0,o.useEffect)(()=>{var e,n,i,l;let t=en.find(e=>e.uid===U);(null==t?void 0:null===(n=t.reservation)||void 0===n?void 0:null===(e=n.details)||void 0===e?void 0:e.length)&&(ee(t),W(null==t?void 0:null===(l=t.reservation)||void 0===l?void 0:null===(i=l.details)||void 0===i?void 0:i.map(e=>{var n,i,l,o,r,d,a;return{title:(null==e?void 0:null===(i=e.room)||void 0===i?void 0:null===(n=i.roomType)||void 0===n?void 0:n.title)+"  ("+(null==e?void 0:null===(l=e.room)||void 0===l?void 0:l.roomNumber)+")",name:(null==t?void 0:null===(r=t.reservation)||void 0===r?void 0:null===(o=r.booker)||void 0===o?void 0:o.firstName)+" "+(null==t?void 0:null===(a=t.reservation)||void 0===a?void 0:null===(d=a.booker)||void 0===d?void 0:d.lastName),arrival:ei+" "+el,guests:(null==e?void 0:e.infants)+" "+(null==e?void 0:e.adults)+" "+(null==e?void 0:e.children),nights:null==e?void 0:e.nights,fee:null==e?void 0:e.fee}})))},[en]),(0,l.jsxs)(s.Z,{gutter:[16,16],className:"mt-8",children:[(0,l.jsx)(u.Z,{md:18,children:(0,l.jsxs)(d.Z,{vertical:!0,gap:16,children:[(0,l.jsx)(v.Z,{title:K("Reservation Summary"),bordered:!0,items:null!=eo?eo:[]}),(0,l.jsx)(c.Z,{title:K("Accomodation Summary"),bodyStyle:{padding:0},loading:J,children:(0,l.jsx)(m.Z,{columns:et,dataSource:V,pagination:{hideOnSinglePage:!0}})})]})}),(0,l.jsx)(u.Z,{md:6,children:(0,l.jsx)(c.Z,{title:K("Bill"),bodyStyle:{padding:0},loading:J,children:(0,l.jsx)(x.default,{folio:(null==X?void 0:null===(F=X.reservation)||void 0===F?void 0:null===(q=F.folios)||void 0===q?void 0:q.length)&&(null==X?void 0:null===(H=X.reservation)||void 0===H?void 0:H.folios[0]),reservation:null==X?void 0:X.reservation,activeId:U})})})]})}},14838:function(e,n,i){i.r(n),i.d(n,{default:function(){return N}});var l=i(85893),t=i(67294),o=i(12930),r=i(19477),d=i(89606),a=i(67421),s=i(78605),u=i(50319),v=i(69027),c=i(11163),m=i(45007),x=i(94113),h=i(34800),p=i(90110),b=e=>{let{open:n,subTitle:i,title:t,extra:o,description:r}=e;return(0,l.jsxs)(h.Z,{style:{position:"relative",top:100},title:"",centered:!0,open:n,footer:[],closable:!1,children:[(0,l.jsx)(p.Z,{src:"/images/modals/body.png",alt:"mangotels",className:"success-image",width:250}),(0,l.jsx)(p.Z,{src:"/images/modals/hands.png",alt:"mangotels",className:"success-image-hands",width:189}),(0,l.jsxs)("div",{className:"flex flex-col space-y-8 justify-center items-center",children:[(0,l.jsx)("h1",{className:"text-center text-4xl font-black mt-5 mb-3",children:t}),(0,l.jsx)("div",{className:"bg-green-50 font-bold text-2xl py-4 px-8 rounded-full border border-green-300 border-dashed text-green-600",children:i}),(0,l.jsx)("p",{className:"text-center",children:r}),o]})]})},g=i(82729),f=i(68806),j=i(54910);function y(){let e=(0,g._)(["\n  mutation checkedIn($input: CheckedInInput!) {\n    checkedIn(input: $input) {\n      id\n    }\n  }\n"]);return y=function(){return e},e}let k=(0,f.ZP)(y());(0,j.B)(k);var N=e=>{let{folio:n,reservation:i,activeId:h}=e,{t:p}=(0,a.$G)(),g=(0,c.useRouter)(),[f,j]=(0,t.useState)(!1),[y,N]=(0,t.useState)(null),Z=(0,m.I0)(),I=[{title:p("Item"),key:"item",render:e=>(0,l.jsx)("p",{children:e.title})},{title:p("Total"),key:"total",width:100,render:e=>{var i;return(0,l.jsx)("p",{children:e.fee&&(0,s.aw)(e.quantity*e.fee)+p(null==n?void 0:null===(i=n.currency)||void 0===i?void 0:i.title)})}}],[Y,{loading:w}]=(0,u.D)(v._,{onCompleted:e=>{let{createPayment:n}=e;n.id&&(j(!0),N(n))}}),[S]=(0,u.D)(x.L,{onCompleted:()=>{j(!0)}}),[P]=(0,u.D)(k),R=e=>{"checkedIn"===e&&P({variables:{input:{reservation:parseInt(i.id)}}}),S({variables:{input:{id:parseInt(i.id),status:e}}})};return(0,l.jsxs)("div",{children:[(0,l.jsx)(b,{open:f,title:p("Reservation has successfully created"),subTitle:"".concat(p("Order number:")," ").concat(null==i?void 0:i.reservationNumber),description:"".concat(p("Your reservation was successful and you will be automatically redirected to the reservation page in the next few seconds.")),extra:[(0,l.jsxs)("div",{className:"flex-row flex space-x-4 gap-x-2 items-center justify-center",children:[(0,l.jsx)(o.ZP,{type:"primary",size:"large",onClick:()=>{Z.reservation.removeActiveReservation(h),g.push("/crs/reservation/".concat(null==i?void 0:i.id))},className:" hover:bg-primary hover:text-primary-foreground border-0 bg-secondary flex flex-row space-x-2 rtl:space-x-reverse",children:p("Reservation Detail")},"console"),(0,l.jsx)(o.ZP,{onClick:()=>{Z.reservation.removeActiveReservation(h),g.push("/crs/reservations/add")},size:"large",className:"text-black items-center flex flex-row space-x-2 rtl:space-x-reverse",children:p("New Reservation")},"buy")]},1)]}),(0,l.jsx)(r.Z,{columns:I,dataSource:null==n?void 0:n.items,pagination:{hideOnSinglePage:!0}}),(0,l.jsx)(d.Z,{}),(0,l.jsxs)("div",{className:"px-8",children:[(0,l.jsxs)("h1",{className:"text-xl font-bold",children:[p("Total")," ",(0,l.jsx)("span",{className:"text-xl font-light",children:n?(0,s.aw)(null==n?void 0:n.subTotal)+" تومان":""})]}),(0,l.jsxs)("div",{className:"flex flex-row gap-x-4 mt-12",children:[(0,l.jsx)(o.ZP,{block:!0,loading:w,onClick:()=>{var e;Y({variables:{input:{title:"POS TITLE",reservation:parseInt(i.id),folio:parseInt(n.id),issuedFor:parseInt(null==i?void 0:null===(e=i.user)||void 0===e?void 0:e.id),paymentMethod:"POS",debit:null==n?void 0:n.subTotal}}})},children:p("Pay with pos")}),(0,l.jsx)(o.ZP,{block:!0,children:p("Send payment link")})]})]}),(0,l.jsx)(d.Z,{}),(0,l.jsxs)("div",{className:"flex flex-row gap-x-4 mt-12 mx-2 mb-2",children:[(0,l.jsx)(o.ZP,{block:!0,size:"large",onClick:()=>R("checkedIn"),className:"bg-secondary text-white hover:bg-primary hover:text-primary-foreground border-0 justify-center",children:p("Submit & Check-in")}),(0,l.jsx)(o.ZP,{block:!0,size:"large",onClick:()=>R("confirmed"),className:"bg-secondary text-white hover:bg-primary hover:text-primary-foreground border-0 justify-center",children:p("Submit Reservation")})]})]})}},69027:function(e,n,i){i.d(n,{_:function(){return d}});var l=i(82729),t=i(68806),o=i(54910);function r(){let e=(0,l._)(["\n  mutation createPayment($input: CreatePaymentInput!) {\n    createPayment(input: $input) {\n      id\n    }\n  }\n"]);return r=function(){return e},e}let d=(0,t.ZP)(r());(0,o.B)(d)},94113:function(e,n,i){i.d(n,{L:function(){return d}});var l=i(82729),t=i(68806),o=i(54910);function r(){let e=(0,l._)(["\n  mutation updateReservation($input: UpdateReservationInput!) {\n    updateReservation(input: $input) {\n      id\n      title\n      description\n      status\n      reservationNumber\n      source {\n        title\n      }\n      hotel {\n        id\n        name\n      }\n      booker {\n        firstName\n        lastName\n        email\n        mobileNumber\n        nationalId\n        gender\n      }\n      guests {\n        firstName\n        lastName\n        email\n        mobileNumber\n        nationalId\n        gender\n      }\n      folios {\n        id\n        subTotal\n        currency {\n          title\n          slug\n          iso\n        }\n        items {\n          title\n          fee\n          quantity\n        }\n      }\n      fee\n      details {\n        id\n        checkedIn\n        checkedOut\n        status\n        nights\n        fee\n        adults\n        children\n        infants\n        room {\n          id\n          title\n          roomNumber\n          roomType {\n            id\n            title\n          }\n        }\n      }\n      deletedAt\n      createdAt\n    }\n  }\n"]);return r=function(){return e},e}let d=(0,t.ZP)(r());(0,o.B)(d)}}]);