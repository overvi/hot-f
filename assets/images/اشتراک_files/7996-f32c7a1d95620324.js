"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7996],{72187:function(e,l,t){t.r(l),t.d(l,{default:function(){return D}});var a=t(85893),n=t(50319),i=t(73359),r=t(56978),s=t(82729),d=t(68806),u=t(54910);function c(){let e=(0,s._)(["\n  query calculateRate($args: RateCalculationArgs!) {\n    calculateRate(args: $args) {\n      currency {\n        id\n        slug\n        title\n      }\n      roomType {\n        id\n        title\n      }\n      foreignerRate\n      b2bRate\n      nights\n      adults\n      children\n      perNights\n      fee\n    }\n  }\n"]);return c=function(){return e},e}let o=(0,d.ZP)(c());(0,u.B)(o);let m=[{value:"0",label:"0"},{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"},{value:"6",label:"6"},{value:"7",label:"7"},{value:"8",label:"8"},{value:"9",label:"9"},{value:"10",label:"10"}];var h=t(78605),v=t(8453),f=t(36460),x=t(98803),p=t(52152),g=t(12930),j=t(95294),y=t(30381),b=t.n(y),Y=t(67294),R=t(67421),Z=t(45007),D=(0,Y.memo)(e=>{var l,t,s;let{record:d,checkedIn:u,checkedOut:c,selectedId:y,selectedRate:D,selectedType:I,source:S,activeId:k}=e,[w,N]=(0,Y.useState)(null),[M,O]=(0,Y.useState)("basicRate"),[F]=v.Z.useForm(),[A,C]=(0,Y.useState)(null==d?void 0:d.rooms[0]),[E,P]=(0,Y.useState)(),$=(0,Z.I0)(),{t:B,i18n:T}=(0,R.$G)(),q=e=>{let l=null==e?void 0:e.reduce((e,l)=>Math.min(e,l[M]),1/0);return null!=l?l:0};(0,Y.useEffect)(()=>{var e;let l=null==d?void 0:null===(e=d.rates)||void 0===e?void 0:e.find(e=>parseFloat(e.basicRate)===parseFloat(q(null==d?void 0:d.rates)));F.setFieldValue("rate",null==l?void 0:l.id)},[]),(0,Y.useEffect)(()=>{y===(null==d?void 0:d.id)&&(N(D),O(I),F.setFieldValue("rate",null==D?void 0:D.id))},[null==d?void 0:d.id,y,D,I]);let[V]=(0,n.D)(r.h),[_,{loading:z}]=(0,i.t)(o,{onCompleted:e=>{let{calculateRate:l}=e;$.reservation.addActiveReservationRoom({...E,source:S,fee:l.fee,price:l.fee,total:l.nights},k),f.ZP.success(B("Item added"))},onError:e=>{f.ZP.error(B("Error on fetching data!"))}}),W=(e,l)=>{let t=b()(e.checkedIn).format("YYYY-MM-DD 12:00:00"),a=b()(e.checkedOut).format("YYYY-MM-DD 12:00:00");P(e),_({variables:{args:{roomTypeRate:parseFloat(e.rate),arrivalDate:e.checkedIn,departureDate:e.checkedOut,rateType:e.type,currency:1,nights:b()(a).diff(t,"days"),adults:parseFloat(e.adult),children:parseFloat(e.child)}}})},K=(0,Y.useCallback)(()=>{let e=[];for(let l=null==A?void 0:A.minimumOccupancy;l<=(null==A?void 0:A.maximumOccupancy);l++)e.push((0,a.jsx)(x.default.Option,{value:l,children:l},l));return e},[A]),G=(0,Y.useCallback)(e=>{var l;let t=null==d?void 0:null===(l=d.rooms)||void 0===l?void 0:l.find(l=>l.id===e);t&&(C(t),F.setFieldValue("adult",null==t?void 0:t.minimumOccupancy))},[F,null==d?void 0:d.rooms]);return(0,a.jsxs)(v.Z,{form:F,name:null==d?void 0:d.id,onFinish:e=>W(e,d),initialValues:{id:null==d?void 0:d.id,title:null==d?void 0:d.title,rate:null==w?void 0:w.id,type:I,checkedIn:u,checkedOut:c,adult:null==A?void 0:A.minimumOccupancy,child:0,total:1,room:null==d?void 0:null===(l=d.rooms[0])||void 0===l?void 0:l.id},children:[(0,a.jsx)(v.Z.Item,{name:"title",hidden:!0,children:(0,a.jsx)(p.default,{})}),(0,a.jsx)(v.Z.Item,{name:"type",hidden:!0,children:(0,a.jsx)(p.default,{})}),(0,a.jsx)(v.Z.Item,{name:"room",hidden:!0,children:(0,a.jsx)(p.default,{defaultValue:null==d?void 0:null===(t=d.rooms[0])||void 0===t?void 0:t.id})}),(0,a.jsx)(v.Z.Item,{name:"checkedIn",hidden:!0,children:(0,a.jsx)(p.default,{})}),(0,a.jsx)(v.Z.Item,{name:"checkedOut",hidden:!0,children:(0,a.jsx)(p.default,{})}),(0,a.jsx)(v.Z.Item,{name:"price",hidden:!0,children:(0,a.jsx)(p.default,{})}),(0,a.jsxs)("div",{className:"flex flex-row space-x-2 items-center rtl:space-x-reverse",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center space-x-8 gap-x-4 rtl:space-x-reverse ml-8",children:[(0,a.jsxs)("div",{className:"flex flex-col items-start rtl:space-x-reverse",children:[(0,a.jsx)("p",{className:"font-bold",children:B("Starts from")}),(0,a.jsx)(v.Z.Item,{name:"rate",style:{margin:0,width:130},rules:[{required:!0}],children:w?(0,h.aw)(w[M]):(0,h.aw)(q(null==d?void 0:d.rates))})]}),(0,a.jsx)("div",{children:(0,h.b2)(u,T.language,"YYYY/MM/DD")}),(0,a.jsx)("div",{children:(0,h.b2)(c,T.language,"YYYY/MM/DD")})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)("p",{children:B("Room")}),(0,a.jsx)(v.Z.Item,{name:"room",style:{margin:0,minWidth:80},children:(0,a.jsx)(x.default,{onChange:G,children:null==d?void 0:null===(s=d.rooms)||void 0===s?void 0:s.map(e=>(0,a.jsx)(x.default.Option,{value:e.id,children:e.roomNumber},e.id))})})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)("p",{children:B("Adult")}),(0,a.jsx)(v.Z.Item,{name:"adult",style:{margin:0,width:60},children:(0,a.jsx)(x.default,{children:K()})})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)("p",{children:B("Child")}),(0,a.jsx)(v.Z.Item,{name:"child",style:{margin:0,width:60},children:(0,a.jsx)(x.default,{children:m.map(e=>(0,a.jsx)(x.default.Option,{value:e.value,children:e.label},e.value))})})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)("p",{children:" "}),(0,a.jsx)(v.Z.Item,{shouldUpdate:!0,children:(0,a.jsx)(g.ZP,{loading:z,type:"primary",htmlType:"submit",icon:(0,a.jsx)(j.Z,{size:16}),className:"text-white hover:bg-primary hover:text-primary-foreground border-0 bg-black flex flex-row  rtl:space-x-reverse items-center mt-6",children:(0,a.jsxs)("p",{className:"text-white",children:[" ",B("Add")]})})})]})]})]},null==d?void 0:d.id)})},37996:function(e,l,t){t.r(l),t.d(l,{default:function(){return A}});var a=t(85893),n=t(67294),i=t(22427),r=t(8453),s=t(36460),d=t(85675),u=t(19477),c=t(98803),o=t(12930),m=t(67421),h=t(18866),v=t(83178),f=t(74606),x=t(92813),p=t(73359),g=t(37887),j=t(82729),y=t(68806),b=t(54910);function Y(){let e=(0,j._)(["\n  query checkAvailability($args: CheckRoomsAvailabilityArgs) {\n    checkAvailability(args: $args) {\n      id\n      title\n      rates {\n        id\n        basicRate\n        title\n        b2bRate\n        foreignerRate\n        weeklyRates {\n          id\n          dayOfWeek\n          slug\n          basicRate\n          foreignerRate\n          b2bRate\n          dailyRate\n        }\n      }\n      rooms {\n        id\n        roomNumber\n        status\n        maximumOccupancy\n        minimumOccupancy\n      }\n    }\n  }\n"]);return Y=function(){return e},e}let R=(0,y.ZP)(Y());(0,b.B)(R);var Z=t(3067),D=t.n(Z),I=t(45007),S=t(78605);let k=[{value:"basicRate",label:"Basic Rate"},{value:"foreignerRate",label:"Foreigner Rate"},{value:"b2bRate",label:"B2B Rate"}];var w=t(33479),N=(0,n.memo)(e=>{let{record:l,nights:t,checkedIn:i,selectedRate:s,setSelectedRate:d,selectedId:o,setSelectedId:h,setSelectedType:v}=e,[f,x]=(0,n.useState)([]),[p,g]=(0,n.useState)([]),[j,y]=(0,n.useState)("basicRate"),{t:b,i18n:Y}=(0,m.$G)(),R=[...null==l?void 0:l.rates].sort((e,l)=>e.basicRate-l.basicRate),Z=()=>{let e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n=new Date,i=[],r={};for(let l=1;l<=t;l++){var d,u;let t=new Date(n);t.setDate(n.getDate()+l);let c=e[t.getDay()];i.push({title:(0,a.jsxs)(w.Z,{align:"center",vertical:!0,children:[(0,a.jsx)("span",{children:b((0,S.b0)(c))}),(0,a.jsx)("span",{children:(0,S.b2)(t,Y.language,"D")})]}),dataIndex:l,key:l,align:"center"}),r[l]=(0,S.aw)((0,S.fN)((null==s?void 0:null===(d=s.weeklyRates)||void 0===d?void 0:d.find(e=>e.dayOfWeek===c))&&(null==s?void 0:null===(u=s.weeklyRates)||void 0===u?void 0:u.find(e=>e.dayOfWeek===c)[j])))}return o===(null==l?void 0:l.id)&&g([r]),x(i),i};return(0,n.useEffect)(()=>{Z()},[t,j,s]),(0,n.useEffect)(()=>{d(R[0])},[]),(0,a.jsxs)(r.Z,{initialValues:{type:"basicRate",rate:0},children:[(0,a.jsxs)(w.Z,{gap:8,children:[(0,a.jsx)(r.Z.Item,{name:"rate",style:{margin:0,width:260},rules:[{required:!0}],children:(0,a.jsx)(c.default,{placeholder:b("Rate"),onChange:e=>{d(R[e]),h(l.id)},children:null==R?void 0:R.map((e,l)=>(0,a.jsx)(c.default.Option,{value:l,children:e.title},e.id))})}),(0,a.jsx)(r.Z.Item,{name:"type",style:{margin:0,width:150},rules:[{required:!0}],children:(0,a.jsx)(c.default,{placeholder:b("Rate type"),onChange:e=>{y(e),v(e),h(l.id)},children:k.map(e=>(0,a.jsx)(c.default.Option,{value:e.value,children:b(e.label)},e.value))})})]}),(0,a.jsx)("p",{className:"mt-4 text-neutral-400",style:{height:180},children:(0,S.b2)(i,Y.language,"YYYY MMM")}),(0,a.jsx)("div",{style:{width:"98%",position:"absolute",height:150,top:90},children:(0,a.jsx)(u.Z,{dataSource:p,columns:f,pagination:{hideOnSinglePage:!0},scroll:{x:!0}})})]})}),M=t(72187),O=t(16472);let{RangePicker:F}=i.default;var A=(0,n.memo)(e=>{var l,t;let{source:i,setSource:j,activeId:y,rooms:b,activeReservation:Y}=e,{t:Z,i18n:k}=(0,m.$G)(),[w]=r.Z.useForm(),A=r.Z.useWatch([],w),[C,E]=(0,n.useState)(!1),P=(0,I.I0)(),[$,B]=(0,n.useState)(),[T,q]=(0,n.useState)(),[V,_]=(0,n.useState)(null),[z,W]=(0,n.useState)(null),[K,G]=(0,n.useState)("basicRate"),[U,L]=(0,n.useState)(),[X,H]=(0,n.useState)(0),J=e=>D().from(e,"fa","YYYY/MM/DD");(0,n.useEffect)(()=>{var e;(null==Y?void 0:null===(e=Y.rooms)||void 0===e?void 0:e.length)>0&&H(b.reduce((e,l)=>parseFloat(e)+parseFloat(l.fee),0).toLocaleString())},[Y]);let[Q,{data:ee,loading:el}]=(0,p.t)(R,{fetchPolicy:"network-only",onCompleted:e=>{let{checkAvailability:l}=e;0===l.length&&s.ZP.warning(Z("There are no records to display"))},onError:e=>{d.ZP.error({description:Z("Error"),message:Z(e.message)})}});(0,n.useEffect)(()=>{w.validateFields({validateOnly:!0}).then(()=>{E(!0)},()=>{E(!1)})},[A,U,w]),(0,n.useEffect)(()=>{if(null==Y?void 0:Y.firstStep){let e=null==Y?void 0:Y.firstStep.arrivalDate,l=null==Y?void 0:Y.firstStep.departureDate;w.setFieldsValue({...null==Y?void 0:Y.firstStep,arrivalDate:e,departureDate:l}),q(e),B(l),e&&l&&Q({variables:{args:{...e&&{arrivalDate:e},...l&&{departureDate:l}}}})}},[Y,Q,w]);let{data:et,loading:ea}=(0,g.a)(x.K,{onError:e=>{d.ZP.error({message:Z(e.message),description:Z("error")})}}),en=[{title:Z("Title"),dataIndex:"title",key:"title",render:e=>e},u.Z.EXPAND_COLUMN,{title:Z("Details"),dataIndex:"quantity",render:(e,l)=>(0,a.jsx)(M.default,{activeId:y,record:l,source:i,setSelectedRate:_,selectedRate:V,selectedId:z,selectedType:K,checkedIn:T,checkedOut:$})}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex-row flex mt-12",children:(0,a.jsx)(r.Z,{form:w,name:"filter",layout:"vertical",size:"large",onFinish:e=>{if(!e.range)return!1;let l=J(e.range[0].format("YYYY-MM-DD")).format("YYYY-MM-DD 14:00:00"),t=J(e.range[1].format("YYYY-MM-DD")).format("YYYY-MM-DD 12:00:00");B(t),q(l),P.reservation.addActiveReservation({firstStep:{...e,arrivalDate:l,departureDate:t}},y),T&&$&&Q({variables:{args:{arrivalDate:l,departureDate:t}}})},onValuesChange:(e,l)=>{if(l.time){let e=l.time[1]?l.time[1].format("YYYY-MM-DD 12:00:00"):null,t=l.time[0]?l.time[0].format("YYYY-MM-DD 14:00:00"):null;B(e),q(t)}},children:(0,a.jsxs)("div",{className:"flex-row flex items-center gap-x-4",children:[(0,a.jsx)(r.Z.Item,{label:Z("Select source"),name:"source",rules:[{required:!0}],children:(0,a.jsx)(c.default,{loading:ea,placeholder:Z("Select source"),className:"w-52",onChange:e=>j(e),children:null==et?void 0:null===(t=et.sources)||void 0===t?void 0:null===(l=t.data)||void 0===l?void 0:l.map(e=>{var l;return(0,a.jsx)(c.default.Option,{value:e.id,children:null!==(l=e.title)&&void 0!==l?l:e.label},e.id)})})}),(0,a.jsxs)(r.Z.Item,{name:"range",label:Z("Arrival date"),rules:[{required:!0}],children:[(0,a.jsx)(O.Km,{}),(0,a.jsx)(F,{onCalendarChange:e=>{w.setFieldValue("range",e)},disabledDate:e=>(0,S.Dy)(e,U)})]}),(0,a.jsx)(r.Z.Item,{label:" ",children:(0,a.jsx)(o.ZP,{loading:el,type:"primary",htmlType:"submit",icon:(0,a.jsx)(f.Z,{size:16,variant:"Bulk"}),disabled:!C,className:"text-zinc-900",children:Z("Search")})})]})})}),(0,a.jsx)(u.Z,{loading:el,columns:en,rowKey:"id",dataSource:null==ee?void 0:ee.checkAvailability,pagination:{hideOnSinglePage:!0},expandable:{expandIcon:e=>{let{record:l,onExpand:t,expanded:n}=e;return(0,a.jsx)("span",{onClick:e=>{W(l.id),t(l,e)},children:n?(0,a.jsx)(v.Z,{size:18,variant:"Bulk",className:"cursor-pointer hover:text-red-500 transition ease-in-out"}):(0,a.jsx)(h.Z,{size:18,variant:"Bulk",className:"cursor-pointer hover:text-orange-500 text-zinc-500 transition ease-in-out"})})},expandedRowRender:e=>(0,a.jsx)(N,{record:e,nights:D()($).endOf("day").diff(T,"days"),checkedIn:T,setSelectedRate:_,selectedRate:V,setSelectedId:W,selectedId:z,setSelectedType:G})}}),(0,a.jsx)("div",{className:"flex flex-row gap-x-2 items-center mt-4",children:(0,a.jsxs)("div",{className:"border  rounded-lg w-full h-10  flex flex-row items-center px-12 mt-2 justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-row gap-x-4",children:[(0,a.jsx)("p",{className:"font-light",children:Z("Advanced payment")}),(0,a.jsxs)("p",{className:"font-bold",children:["0 ",(0,a.jsx)("span",{children:"تومان"})]})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-x-4",children:[(0,a.jsx)("p",{className:"font-light",children:Z("Total")}),(0,a.jsxs)("p",{className:"font-bold",children:[X,(0,a.jsx)("span",{children:"تومان"})]})]})]})})]})})},56978:function(e,l,t){t.d(l,{h:function(){return s}});var a=t(82729),n=t(68806),i=t(54910);function r(){let e=(0,a._)(["\n  mutation updateRoomStatus($input: UpdateRoomStatusInput!) {\n    updateRoomStatus(input: $input) {\n      id\n    }\n  }\n"]);return r=function(){return e},e}let s=(0,n.ZP)(r());(0,i.B)(s)},92813:function(e,l,t){t.d(l,{K:function(){return s}});var a=t(82729),n=t(68806),i=t(54910);function r(){let e=(0,a._)(["\n  query sources($first: Int, $page: Int, $args: SourceArgs) {\n    sources(first: $first, page: $page, args: $args) {\n      paginatorInfo {\n        total\n      }\n      data {\n        id\n        title\n        direct\n        type\n        isActive\n        deletedAt\n        createdAt\n        updatedAt\n      }\n    }\n  }\n"]);return r=function(){return e},e}let s=(0,n.ZP)(r());(0,i.B)(s)}}]);